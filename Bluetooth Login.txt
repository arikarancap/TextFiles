import React, { useState, useEffect } from "react";
import { View, Text, SafeAreaView, Keyboard, Alert, StyleSheet, ScrollView } from 'react-native';
import { useLogin } from '../../Main/LoginProvider';
import { Input, Loader, CustomButton } from "../../components";
import { COLORS, PORT } from '../../constants'
export function Login({ navigation }) {
    const { isLoggedIn, setIsLoggedIn, SubMenu, setSubMenu } = useLogin();
    const [inputs, setInputs] = React.useState({ email: '', password: '', datas: '', noUser: '' });
    const [errors, setErrors] = React.useState({});
    const [loading, setLoading] = React.useState(false);
    const useFetch = () => {
        console.log("Loading to Get Components")
        fetch(PORT, {
            method: 'GET'
        })
            .then(res => res.json())
            // .then(data => { setData(data)})
            .then(data => {
                console.log(data)
                handleOnchange(data, 'datas')
                // setData(data)
            })
            .catch(err => console.log("Error Acquired", err));
    }
    useEffect(() => {
        useFetch()
    }, [isLoggedIn])
    const validate = async () => {
        Keyboard.dismiss();
        let isValid = true;
        if (!inputs.email) {
            handleError('Please input email', 'email');
            isValid = false;
        }
        if (!inputs.password) {
            handleError('Please input password', 'password');
            isValid = false;
        }
        if (isValid) {
            login();
        }
    };

    const login = () => {
        useFetch()
        // console.log(username, password)
        inputs.datas.map((item) => {
            console.log(item.username, item.password)
            if (item.username == inputs.email && item.password == inputs.password) {
                console.log("user Entered the App...")
                // setNoUser(false)
                setIsLoggedIn(true)
            }
            else {
                // Alert.alert("No User", "There is  no user")
                // noUser(true)
                handleOnchange(true, 'noUser')

            }
        })
    }
    const handleOnchange = (text, input) => {
        setInputs(prevState => ({ ...prevState, [input]: text }));
    };

    const handleError = (error, input) => {
        setErrors(prevState => ({ ...prevState, [input]: error }));
    };
    const check = () => {
        if ("Kamal" == username && "123456" == password) {
            console.log("user Entered the App...")
            setIsLoggedIn(true)
        }
        // setIsLoggedIn(true)
    }
    return (
        <SafeAreaView style={{ backgroundColor: COLORS.white, flex: 1 }}>
            <Loader visible={loading} />
            <ScrollView contentContainerStyle={{
                paddingTop: 10,
                paddingHorizontal: 10,
                // flex: 1,
                // alignItems: 'center'
                // borderWidth:1,borderColor: 'black'
                // alignItems: 'center'
            }} >
                <View style={{ paddingTop: 50, paddingHorizontal: 10, }}>

                    <Text style={{ color: COLORS.black, fontSize: 40, fontWeight: '600' }}>
                        Log In
                    </Text>
                    <Text style={{ color: COLORS.grey, fontSize: 18, marginTop: 30 }}>
                        Enter Your Details to Login
                    </Text>
                    <View style={{ marginVertical: 50, width: '100%', }}>
                        <Input
                            onChangeText={text => handleOnchange(text, 'email')}
                            onFocus={() => handleError(null, 'email')}
                            iconName="email-outline"
                            label="Email"
                            placeHolder="Enter your email address"
                            error={errors.email}
                        />
                        <Input
                            onChangeText={text => handleOnchange(text, 'password')}
                            onFocus={() => handleError(null, 'password')}
                            iconName="lock-outline"
                            label="Password"
                            placeHolder="Enter your password"
                            error={errors.password}
                            password
                        />
                        <CustomButton title="Log In" onPress={validate} />
                        <Text style={{ color: 'red', fontSize: 14 }} >{inputs.noUser ? 'User Not Valid' : ''}</Text>

                        <View style={{ flexDirection: 'row', alignItems: 'center', justifyContent: 'center', width: '100%', marginTop: 10 }} >
                            <Text
                                onPress={() => { navigation.navigate("Forgot"); }}
                                style={styles.text}>
                                Forgot Passsword
                            </Text>
                            <Text
                                onPress={() => { navigation.navigate("Forgot"); }}
                                style={[styles.text, { color: COLORS.blue, marginLeft: 5 }]}>Click</Text>
                        </View>
                        <View style={{ flexDirection: 'row', alignItems: 'center', justifyContent: 'center', width: '100%', marginTop: -5 }} >
                            <Text
                                onPress={() => navigation.navigate("SignUp")}
                                style={styles.text}>
                                Don't have account ?
                            </Text>
                            <Text
                                onPress={() => navigation.navigate("SignUp")}
                                style={[styles.text, { color: COLORS.blue, marginLeft: 5 }]}>Register</Text>
                        </View>

                    </View>
                    {/* <View style={{ position: 'absolute', top: 700 }}>
                       
                    </View> */}
                </View>

            </ScrollView>

        </SafeAreaView>
    );
}
const styles = StyleSheet.create({
    text: {
        color: COLORS.black,
        fontWeight: 'bold',
        textAlign: 'center',
        fontSize: 16,
        paddingTop: 10,
    }

});

// import React, { useState } from 'react';
// import { View, TextInput, Animated, StyleSheet } from 'react-native';

// export const SignIn = () => {
//     const [isFocused, setIsFocused] = useState(false);
//     const animatedIsFocused = React.useRef(new Animated.Value(0)).current;

//     const handleFocus = () => setIsFocused(true);
//     const handleBlur = () => setIsFocused(false);
// let value=''
//     React.useEffect(() => {
//         Animated.timing(animatedIsFocused, {
//             toValue: isFocused || value !== '' ? 1 : 0,
//             duration: 200,
//             useNativeDriver: false,
//         }).start();
//     }, [animatedIsFocused, isFocused, value]);

//     const labelStyle = {
//         position: 'absolute',
//         left: 0,
//         top: animatedIsFocused.interpolate({
//             inputRange: [0, 1],
//             outputRange: [18, 0],
//         }),
//         fontSize: animatedIsFocused.interpolate({
//             inputRange: [0, 1],
//             outputRange: [20, 14],
//         }),
//         color: animatedIsFocused.interpolate({
//             inputRange: [0, 1],
//             outputRange: ['#aaa', '#000'],
//         }),
//     };

//     return (
//         <View style={styles.container}>
//             <Animated.Text style={labelStyle}>Username</Animated.Text>
//             <TextInput
//                 style={styles.input}
//                 onFocus={handleFocus}
//                 onBlur={handleBlur}
//                 underlineColorAndroid="transparent"
//             />
//         </View>
//     );
// };

// const styles = StyleSheet.create({
//     container: {
//         marginTop: 20,
//         width: '100%',
//         height: 60,
//         padding: 10,
//         borderBottomWidth: 1,
//         borderBottomColor: '#ccc',
//     },
//     input: {
//         fontSize: 18,
//         marginTop: 10,
//         paddingLeft: 6,
//         paddingBottom: 10,
//     },
// });

// // export default StylishTextInput;

// import { View, Text } from 'react-native'
// import React, { useState } from 'react'
// import { CustomInput } from '../components/CustomInput';
// export const Login = () => {
//     const [borderName, SetBorderName] = useState(false)
//     const [SecondBorderName, setSecondBorderName] = useState(false)
//     return (
//         <View style={{ alignItems: 'center', justifyContent: 'center' }}>
//             <Text>Login</Text>
//             <CustomInput placeHolder={'User'}
//                 setState1={SetBorderName}
//                 setState2={setSecondBorderName}
//                 placeName={borderName}


//             />
//             <CustomInput placeHolder={'Password'}
//                 setState1={setSecondBorderName}
//                 setState2={SetBorderName}
//                 placeName={SecondBorderName}

//             />

//         </View>
//     )
// }
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////
export const CustomButton = ({ title, onPress, iconName, margin, Styles }) => {
  return (
    <TouchableOpacity
      onPress={onPress}
      // activeOpacity={0.7}
      style={[
        {
          height: 55,
          // width: '100%',
          backgroundColor: COLORS.blue,
          justifyContent: 'center',
          alignItems: 'center',
          marginVertical: margin ? margin : 20,
          // flexDirection: 'row'
        }, { Styles }
      ]} >
      <Text style={{
        color: COLORS.white,
        fontWeight: 'bold',
        fontSize: 18,
      }} >{title} </Text>
    </TouchableOpacity >
  )
}